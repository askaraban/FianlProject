<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="swift.air.mapper.ScheduleMapper">
	<insert id="insertSchedule">
		<selectKey resultType="int" keyProperty="scheduleId" order="BEFORE">
			select schedule_seq.nextval from dual
		</selectKey>
		insert into schedule values(#{scheduleId}, #{scheduleDepartureDate}, #{scheduleArrivalDate}, #{scheduleFlight}, #{scheduleRouteId})
	</insert>
	
	<update id="updateSchedule">
		update schedule set schedule_departure_date=#{scheduleDepartureDate}, schedule_arrival_date=#{scheduleArrivalDate}
			, schedule_flight=#{scheduleFlight}, schedule_route_id=#{scheduleRouteId} where schedule_id=#{scheduleId}
	</update>
	
	<delete id="deleteSchedule">
		delete from schedule where schedule_id=#{scheduleId}
	</delete>
	
	<resultMap type="Schedule" id="scheduleResultMap" >
		<id column="schedule_id" property="scheduleId" />
		
    	<association javaType="Schedule" property="schedule">
	    	<id column="schedule_id" property="scheduleId" />
	    	<result column="schedule_departure_date" property="departureDate"/>
	    	<result column="schedule_arrival_date" property="arrivalDate"/>
	    	<result column="schedule_flight" property="flight"/>
	    	<result column="schedule_route_id" property="scheduleRouteId"/>
   		</association>	
    	
    	<association javaType="Route" property="route">
        	<id column="route_id" property="routeId"/>
        	<result column="route_departure" property="routeDeparture"/>
        	<result column="route_destination" property="routeDestination"/>
        	<result column="route_time" property="routeTime"/>
        	<result column="route_price" property="routePrice"/>
   		</association>	
	</resultMap>

	<select id="selectSchedule" parameterType="int" resultMap="scheduleResultMap"> 
		select schedule_id, schedule_departure_date, schedule_arrival_date, schedule_flight, schedule_route_id 
			from schedule join route on schedule_route_id=route_id where schedule_id=#{scheduleId}
	</select>
	 
	<select id="selectScheduleCount" resultType="int">
		select count(*) from schedule
	</select>
	
	<select id="selectScheduleList" resultMap="scheduleResultMap">
		select * from (select rownum rn, schedulelist.* from (select schedule_id, schedule_departure_date
			, schedule_arrival_date, schedule_flight, schedule_route_id from schedule join route on 
			schedule_route_id=route_id order by schedule_id desc)
			schedulelist) where rn between #{startRow} and #{endRow}
	</select>
</mapper>